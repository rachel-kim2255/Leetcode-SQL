name: Initialize Full Progress Log
on:
  workflow_dispatch:

jobs:
  init-progress:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build initial progress log
        run: |
          echo "" >> README.md
          echo "# ðŸ“ˆ Progress Log" >> README.md
          echo "| Date | Problems Added | Total |" >> README.md
          echo "|------|----------------|--------|" >> README.md
          
          total=0
          git log --reverse --pretty=format:"%ad" --date=short -- '**/*.sql' | sort | uniq -c > tmp.log

          while read count date; do
            total=$((total + count))
            echo "| $date | ðŸŸ¢ $count | $total |" >> README.md
          done < tmp.log

          echo "" >> README.md
          echo "> **ðŸŽ¯ Total:** $total problems solved" >> README.md
          rm tmp.log

      - name: Commit and push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add README.md
          git commit -m "Initialize full Progress Log"
          git push
